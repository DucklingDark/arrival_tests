# Тестовое задание №1

#### Выполняемый функционал:
Для микроконтроллера реализован алгоритм взаимодействия по интерфесу UART.   
При успешном получении корректного пакета, такой же пакет отправляется в качестве ответа с утсановленным старшим битом в поле "тип".
____
Формат пакета:
```
struct Packet{
	uint8_t	preamble;		// преамбула = 0xFF
	uint8_t cnt;			// счетчик пакетов
	uint8_t type;			// тип пакета
	uint8_t length;			// длина поля данных
	uint8_t data[255+1];	// массив данных, плюс место под CRC8
};
```
#### Содержимое папок:
- Папка Inc содержит заголовочные файлы
- Папка Src содержит файлы с исходным кодом

#### Содержимое файлов:
- **funcs.h** содержит структуру пакета данных и определение функций
- **funcs.c** содержит описание функций
- **main.c** содержит главный цикл программы
- **stm32f1xx_it.c** содержит обработчик прерывания UART

## Ключевые блоки кода:

#### Переменные:
`uint8_t rx_byte` - переменная, в которую считывается новый байт из DR регистра интерфейса UART  
`uint8_t rx_buffer[UART_BUFF_SIZE]` - кольцевой массив для входных данных интерфейса UART  
`uint16_t processed` - позиция обработанного байта в кольцевом массиве  
`uint16_t received` - позиция принятого байта в кольцевом массиве  
`Packet_t packet` - переменная, содержащая струтуру пакета данных  
`uint8_t state` - текущий этап машины состояний  
`uint8_t crc8` - переменная для CRC8  
`uint8_t new_processed` - флаг наличия нового обработанного пакета  
`uint8_t n_byte` - переменная, хранящая новый байт из массива входных данных  
`uint16_t data_cnt` - позиция записанного байта из "поля данных" входного пакета  
`uint16_t tx_pos` - позиция отправленного байта из обработанного пакета данных  
`uint8_t *tx_buf` - массив для отправки принятого пакета с изменённым полем "тип"  
`uint16_t packet_size` - размер буфера для массива, который необходимо отправить  

#### Структуры:
`typedef struct Packet` - структура пакета данных

#### Функции:
`void UART4_IRQHandler(void)` - функция обработчик прерывания UART  
`uint8_t is_not_processed(void)` - функция проверки наличия необработанных байт кольцевого массива  
`void uart_routine(void)` - функция обработки принятых байт  
`uint8_t calc_crc8(uint8_t *data, uint16_t len` - функция подсчёта CRC8  
`void send_next_byte(void)` - функция отправки байт из массива с ответным пакетом  

#### Дополнительные ключевые строки кода:
`__HAL_UART_ENABLE_IT(&huart4, UART_IT_RXNE)` - включение прерывания интерфейса UART по флагу RXNE (RX not empty)